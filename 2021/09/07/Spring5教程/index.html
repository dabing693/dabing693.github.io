<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring5教程 | 小辉博客</title><meta name="description" content="Spring5教程 Spring概述 IOC容器，容器即对象工厂（工厂模式） IOC底层原理 IOC接口（BeanFactory） IOC操作bean管理（基于xml） IOC操作bean管理（基于注解）   Aop JdbcTemplate 事务管理 Spring5新特性  Spring框架 Spring是轻量级的开源java框架 Spring可以解决企业应用开发的复杂性 Spring有两个核心"><meta name="author" content="dabing693"><meta name="copyright" content="dabing693"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/2021/09/07/Spring5%E6%95%99%E7%A8%8B/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Spring5教程"><meta property="og:url" content="http://yoursite.com/2021/09/07/Spring5%E6%95%99%E7%A8%8B/"><meta property="og:site_name" content="小辉博客"><meta property="og:description" content="Spring5教程 Spring概述 IOC容器，容器即对象工厂（工厂模式） IOC底层原理 IOC接口（BeanFactory） IOC操作bean管理（基于xml） IOC操作bean管理（基于注解）   Aop JdbcTemplate 事务管理 Spring5新特性  Spring框架 Spring是轻量级的开源java框架 Spring可以解决企业应用开发的复杂性 Spring有两个核心"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2021-09-07T13:51:08.279Z"><meta property="article:modified_time" content="2020-12-20T06:19:55.192Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="SpringMVC" href="http://yoursite.com/2021/09/07/SpringMVC/"><link rel="next" title="Mybatis IDEA版教程" href="http://yoursite.com/2021/09/07/Mybatis%20IDEA%E7%89%88%E6%95%99%E7%A8%8B/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="小辉博客" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://ae01.alicdn.com/kf/Hf828ff298f76464d9b00ad99cb873415F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">3</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring5教程"><span class="toc-number">1.</span> <span class="toc-text">Spring5教程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring框架"><span class="toc-number">1.1.</span> <span class="toc-text">Spring框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#入门案例"><span class="toc-number">1.2.</span> <span class="toc-text">入门案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC（概念和原理）"><span class="toc-number">1.3.</span> <span class="toc-text">IOC（概念和原理）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC操作"><span class="toc-number">1.4.</span> <span class="toc-text">IOC操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（概念）"><span class="toc-number">1.4.1.</span> <span class="toc-text">Bean管理（概念）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（基于xml方式）"><span class="toc-number">1.4.2.</span> <span class="toc-text">Bean管理（基于xml方式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bean管理（xml注入其他类型属性）"><span class="toc-number">1.4.3.</span> <span class="toc-text">bean管理（xml注入其他类型属性）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bean管理（xml注入集合属性）"><span class="toc-number">1.4.4.</span> <span class="toc-text">bean管理（xml注入集合属性）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（FactoryBean）"><span class="toc-number">1.4.5.</span> <span class="toc-text">Bean管理（FactoryBean）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（bean的作用域）"><span class="toc-number">1.4.6.</span> <span class="toc-text">Bean管理（bean的作用域）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（bean的生命周期）"><span class="toc-number">1.4.7.</span> <span class="toc-text">Bean管理（bean的生命周期）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（xml自动装配）"><span class="toc-number">1.4.8.</span> <span class="toc-text">Bean管理（xml自动装配）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（外部属性文件）"><span class="toc-number">1.4.9.</span> <span class="toc-text">Bean管理（外部属性文件）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean管理（基于注解方式）"><span class="toc-number">1.4.10.</span> <span class="toc-text">Bean管理（基于注解方式）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP-Aspect-Oriented-Programming"><span class="toc-number">1.5.</span> <span class="toc-text">AOP(Aspect Oriented Programming)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是AOP"><span class="toc-number">1.5.1.</span> <span class="toc-text">什么是AOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP底层原理"><span class="toc-number">1.5.2.</span> <span class="toc-text">AOP底层原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP动态代理"><span class="toc-number">1.5.3.</span> <span class="toc-text">AOP动态代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP术语"><span class="toc-number">1.5.4.</span> <span class="toc-text">AOP术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP操作（准备工作）"><span class="toc-number">1.5.5.</span> <span class="toc-text">AOP操作（准备工作）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于AspectJ注解进行Aop操作"><span class="toc-number">1.5.6.</span> <span class="toc-text">基于AspectJ注解进行Aop操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于AspectJ-xml配置文件进行Aop操作"><span class="toc-number">1.5.7.</span> <span class="toc-text">基于AspectJ xml配置文件进行Aop操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JDBCTemplate"><span class="toc-number">1.6.</span> <span class="toc-text">JDBCTemplate</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBCTemplate操作数据库"><span class="toc-number">1.6.1.</span> <span class="toc-text">JDBCTemplate操作数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务"><span class="toc-number">1.7.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建事务操作环境"><span class="toc-number">1.7.1.</span> <span class="toc-text">搭建事务操作环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring事务管理"><span class="toc-number">1.7.2.</span> <span class="toc-text">spring事务管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于注解的声明式事务管理"><span class="toc-number">1.7.3.</span> <span class="toc-text">基于注解的声明式事务管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#声明式事务管理参数配置"><span class="toc-number">1.7.4.</span> <span class="toc-text">声明式事务管理参数配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于xml方式的声明式事务管理"><span class="toc-number">1.7.5.</span> <span class="toc-text">基于xml方式的声明式事务管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#完全注解声明式事务管理"><span class="toc-number">1.7.6.</span> <span class="toc-text">完全注解声明式事务管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring5框架新功能"><span class="toc-number">1.7.7.</span> <span class="toc-text">Spring5框架新功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring5—–新功能Springwebflux"><span class="toc-number">1.7.8.</span> <span class="toc-text">spring5—–新功能Springwebflux</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">小辉博客</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Spring5教程</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-09-07 21:51:08"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2021-09-07</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-12-20 14:19:55"><i class="fas fa-history fa-fw"></i> 更新于 2020-12-20</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Spring5教程"><a href="#Spring5教程" class="headerlink" title="Spring5教程"></a>Spring5教程</h1><ul>
<li>Spring概述</li>
<li>IOC容器，容器即对象工厂（工厂模式）<ul>
<li>IOC底层原理</li>
<li>IOC接口（BeanFactory）</li>
<li>IOC操作bean管理（基于xml）</li>
<li>IOC操作bean管理（基于注解）</li>
</ul>
</li>
<li>Aop</li>
<li>JdbcTemplate</li>
<li>事务管理</li>
<li>Spring5新特性</li>
</ul>
<h2 id="Spring框架"><a href="#Spring框架" class="headerlink" title="Spring框架"></a>Spring框架</h2><ol>
<li>Spring是轻量级的开源java框架</li>
<li>Spring可以解决企业应用开发的复杂性</li>
<li>Spring有两个核心部分：IOC和AOP<ul>
<li>IOC:控制反转，把创建对象过程交给Spring进行管理</li>
<li>AOP:面向切面，不修改源代码进行功能增强</li>
</ul>
</li>
<li>Spring特点</li>
</ol>
<p>（1）方便解藕，简化开发</p>
<p>（2）Aop编程支持</p>
<p>（3）方便程序测试</p>
<p>（4）方便和其他框架进行整合</p>
<p>（5）方便进行事务操作</p>
<p>（6）降低API开发难度</p>
<p>一句话概括：</p>
<p><strong>Spring是一个轻量级的控制反转(IoC)和面向切面(AOP)的容器（框架）。</strong></p>
<p><img src= "/img/loading.gif" data-src="http://ww1.sinaimg.cn/large/ad3c4311gy1glrz6pdhyoj20kd0f0gnv.jpg" alt="spring framework runtime"></p>
<h2 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h2><ol>
<li>下载Spring5 ，<a href="https://repo.spring.io/release/org/springframework/spring/" target="_blank" rel="noopener">下载地址</a></li>
<li>Idea创建普通java工程</li>
<li>导入spring5相关jar包</li>
<li>创建一个普通类，在这个类创建一个普通方法</li>
<li>使用xml创建spring配置文件，在配置文件中配置要创建的对象</li>
<li>进行测试代码编写</li>
</ol>
<h2 id="IOC（概念和原理）"><a href="#IOC（概念和原理）" class="headerlink" title="IOC（概念和原理）"></a>IOC（概念和原理）</h2><p>1、什么是IOC</p>
<p>(1) 控制反转，把对象创建和对象之间的调用过程，交给spring进行管理</p>
<p>(2) 使用IOC的目的：为了降低耦合度</p>
<p>2、IOC底层原理</p>
<p>xml解析–&gt;工厂模式–&gt;反射（得到class文件）</p>
<p>3、IOC底层原理（图）</p>
<p><img src= "/img/loading.gif" data-src="https://images2017.cnblogs.com/blog/1220001/201709/1220001-20170905175004757-1285779321.png" alt="IOC底层原理"> </p>
<p>4、IOC(接口)</p>
<ul>
<li>IOC思想基于IOC容器完成，IOC容器底层就是对象工厂。</li>
<li>Spring提供IOC容器两种实现方式：（两个接口）</li>
</ul>
<p>（1）BeanFactory：IOC容器基本实现，是Spring内部的使用接口，不建议开发人员使用。</p>
<p>加载配置文件的时候不创建对象，在获取（使用）对象时才创建对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanFactory context=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean1.xml"</span>);</span><br></pre></td></tr></table></figure>

<p>（2）ApplicationContext：BeanFactory的子接口，提供更多更强大的功能，一般由开发人员进行使用。</p>
<p>加载配置文件的时候就把对象创建。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean1.xml"</span>);</span><br></pre></td></tr></table></figure>

<p>5 、ApplicationContext实现类接口</p>
<p>==Ctrl+h查看类相关信息== </p>
<ul>
<li>FileSystemXmlApplicationContext：文件系统路径</li>
<li>ClassPathXmlApplicationContext：相对于src的类路径</li>
</ul>
<h2 id="IOC操作"><a href="#IOC操作" class="headerlink" title="IOC操作"></a>IOC操作</h2><h3 id="Bean管理（概念）"><a href="#Bean管理（概念）" class="headerlink" title="Bean管理（概念）"></a>Bean管理（概念）</h3><p>1、什么是Bean管理</p>
<p>Bean管理指的是两个操作</p>
<p>（1）Spring创建对象</p>
<p>（2）Spring注入属性</p>
<p>2、Bean管理操作方式有两种：</p>
<p>（1）基于xml配置文件方式实现</p>
<p>（2）基于注解方式实现</p>
<h3 id="Bean管理（基于xml方式）"><a href="#Bean管理（基于xml方式）" class="headerlink" title="Bean管理（基于xml方式）"></a>Bean管理（基于xml方式）</h3><p>1、基于xml创建对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置User对象创建--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"User"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.spring.User"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（1）使用bean标签，标签里面添加属性，就可以实现创建对象</p>
<p>（2）Bean标签常用属性：</p>
<ul>
<li>id：唯一标识</li>
<li>class：类全路径（包类路径）</li>
<li>name：早期spring的属性，不常用</li>
</ul>
<p>（3）创建对象的时候，默认执行无参数构造方法，完成对象创建。（因此类只有有参构造方法就会报错）</p>
<p>2、基于xml注入属性</p>
<p>（1）DI(Dependency injection)：依赖注入，就是注入属性</p>
<p>第一种注入方式：使用set方法注入</p>
<p>（1）创建类，定义属性和对应的set方法</p>
<p>（2）在Spring配置文件中配置类创建，配置属性注入</p>
<p>第二种注入方式：通过有参构造注入</p>
<p>（1）创建类，定义属性和对应的有参构造方法</p>
<p>（2）在Spring配置文件中配置类创建，配置属性注入</p>
<p>3、p名称空间注入，可以简化基于xml配置方式</p>
<p>（1）在配置文件中添加p名称空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p="http://www.springframework.org/schema/p"</span><br></pre></td></tr></table></figure>

<p>（2）在bean标签中进行属性注入</p>
<h3 id="bean管理（xml注入其他类型属性）"><a href="#bean管理（xml注入其他类型属性）" class="headerlink" title="bean管理（xml注入其他类型属性）"></a>bean管理（xml注入其他类型属性）</h3><p>1、字面量</p>
<p>（1) null值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"birthday"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--属性注入空值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">null</span>&gt;</span><span class="tag">&lt;/<span class="name">null</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2) 属性值包含特殊符号–转义或者CDATA</p>
<p>2、注入属性–外部bean</p>
<p>（1）创建Service类和Dao类</p>
<p>（2）在Service类中调用Dao类的方法</p>
<p>（3）在spring配置文件中进行配置</p>
<p>3、注入属性–内部bean</p>
<p>（1）一对多的关系：部门和员工，一个部门有多个员工，一个员工属于一个部门</p>
<p>（2）在实体类中表示一对多的关系</p>
<p>（3）在spring配置文件中进行相关配置</p>
<p>4、注入属性–级联赋值</p>
<p>（1）第一种写法</p>
<p>（2）第二种写法（得生成相应对象的get方法）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--级联赋值 第二种写法--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"emp_jilian2"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.spring5.bean.Emp"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"empName"</span> <span class="attr">value</span>=<span class="string">"李思睿"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"女"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptOf"</span> <span class="attr">value</span>=<span class="string">"dept"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!--不能少--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"deptOf.deptName"</span> <span class="attr">value</span>=<span class="string">"急诊部"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"dept"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.spring5.bean.Dept"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="bean管理（xml注入集合属性）"><a href="#bean管理（xml注入集合属性）" class="headerlink" title="bean管理（xml注入集合属性）"></a>bean管理（xml注入集合属性）</h3><ol>
<li>注入数组类型属性</li>
<li>注入List集合类型属性</li>
<li>注入map集合类型属性</li>
<li>注入set集合类型属性<ul>
<li>创建集合类型属性，生成对应的set方法</li>
<li>在spring配置文件中进行配置</li>
</ul>
</li>
<li>在集合里面设置集合对象的值</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"courseList"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"course1"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"course1"</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>把集合注入的部分提取出来</li>
</ol>
<p>（1）在spring配置文件中引入名称空间util</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>     			<span class="attr">xmlns:util</span>=<span class="string">"http://www.springframework.org/schema/util"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.1.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）利用util标签完成list注入提取</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1 使用util命名空间配置一个List集合 --&gt;</span>     </span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">value-type</span>=<span class="string">"java.lang.String"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>java入门<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>javaweb教程<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>spring5教程<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--2 对提取的list集合进行注入--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.spring5.colletciontype.Book"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span> <span class="attr">ref</span>=<span class="string">"booklist"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Bean管理（FactoryBean）"><a href="#Bean管理（FactoryBean）" class="headerlink" title="Bean管理（FactoryBean）"></a>Bean管理（FactoryBean）</h3><ol>
<li><p>spring中有两种bean，普通bean（自己创建的），工厂bean（Factorybean）</p>
</li>
<li><p>普通bean：在spring配置文件中定义的bean类型就是返回的类型。</p>
</li>
<li><p>工厂bean：在spring配置文件中定义的bean类型可以和返回的类型不一致，是spring中内置的一种类型。</p>
<ul>
<li><p>创建类，让这个类作为工厂bean，即实现Factory接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanTest</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Course</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现接口里面的方法，在方法中定义返回的bean类型。 </p>
</li>
</ul>
</li>
</ol>
<h3 id="Bean管理（bean的作用域）"><a href="#Bean管理（bean的作用域）" class="headerlink" title="Bean管理（bean的作用域）"></a>Bean管理（bean的作用域）</h3><ol>
<li>在spring里面，bean默认是单实例对象</li>
<li>如何设置是单实例还是多实例<ul>
<li>利用配置文件bean标签的scope属性进行设置</li>
<li>Scope属性值：singleton（单实例），prototype（多实例）</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.spring5.colletciontype.Book"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span> <span class="attr">ref</span>=<span class="string">"booklist"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>singleton和prototype区别<ul>
<li>scope=”singleton”时，加载配置文件的时候就创建单实例对象</li>
<li>scope=”prototype”时，不是加载配置文件的时候就创建对象，在调用getBean方法的时候创建一个多实例对象</li>
</ul>
</li>
</ol>
<p>scope还有两个值：request和session</p>
<p>request是获取信息，通过用户提交的表单，查询字符串，cookie等获得信息</p>
<p>session是服务端用来保存一些数据（通常是标记状态的，当然也可以保存别的)</p>
<h3 id="Bean管理（bean的生命周期）"><a href="#Bean管理（bean的生命周期）" class="headerlink" title="Bean管理（bean的生命周期）"></a>Bean管理（bean的生命周期）</h3><ol>
<li><p>生命周期</p>
<p>从对象创建到对象销毁的过程</p>
</li>
<li><p>演示bean的生命周期</p>
<ol>
<li>执行了无参数构造</li>
<li>调用set方法设置属性</li>
<li>执行初始化方法</li>
<li>得到创建的bean实例对象</li>
<li>执行销毁的方法</li>
</ol>
</li>
<li><p>bean的后置处理器：允许在调用初始化方法前后对 Bean 进行额外的处理。bean生命周期共有7步：</p>
<ol>
<li>通过构造器创建bean实例（无参数构造）</li>
<li>把bean实例传递给后置处理器的方法</li>
<li>为bean的属性设置值和对其他bean的应用（调用set方法）</li>
<li>把bean实例传递给后置处理器的方法（另一个）</li>
<li>调用bean的初始化方法（需要配置初始化的方法）</li>
<li>Bean可以使用了（对象获取到了）</li>
<li>当容器关闭时，调用bean的销毁方法（需要进行配置销毁的方法）</li>
</ol>
</li>
<li><p>演示添加后置处理器的方法</p>
<p>创建类，实现BeanPostProcessor接口，创建后置处理器</p>
</li>
</ol>
<h3 id="Bean管理（xml自动装配）"><a href="#Bean管理（xml自动装配）" class="headerlink" title="Bean管理（xml自动装配）"></a>Bean管理（xml自动装配）</h3><p>1、什么是自动装配</p>
<p>（1）根据指定装配规则（属性名称或属性类型），spring自动将匹配的属性值进行注入</p>
<p>2、演示自动装配过程</p>
<p>bean标签有autowire属性，实现自动装配，autowire有两个常用值：</p>
<p>（1）byName：根据属性名称实现自动装配。要装配的bean的id属性值必须和类属性值一样</p>
<p>（2）byType：根据属性类型实现自动装配。每一个类型的bean标签只能存在一个</p>
<h3 id="Bean管理（外部属性文件）"><a href="#Bean管理（外部属性文件）" class="headerlink" title="Bean管理（外部属性文件）"></a>Bean管理（外部属性文件）</h3><p>1、直接配置数据库信息</p>
<p>（1）配置德鲁伊连接池</p>
<p>（2）引入德鲁伊连接池依赖jar包</p>
<p>2、引入外部属性文件配置数据库连接池</p>
<p>（1）创建外部属性文件，properties格式文件，写上数据库信息</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">prop.driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">prop.url</span>=<span class="string">jdbc:mysql://localhost:3306/school</span></span><br><span class="line"><span class="meta">prop.userName</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">prop.password</span>=<span class="string">314115</span></span><br></pre></td></tr></table></figure>

<p>（2）把外部properties文件引入到spring配置文件中来</p>
<ol>
<li>引入context名称空间</li>
<li>配置context引入properties文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"jdbc.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;prop.driverClass&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;prop.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;prop.userName&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;prop.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Bean管理（基于注解方式）"><a href="#Bean管理（基于注解方式）" class="headerlink" title="Bean管理（基于注解方式）"></a>Bean管理（基于注解方式）</h3><p>1、什么是注解</p>
<ul>
<li>注解代码是特殊标记格式：@注解名称(属性名称1=属性值1,属性名称2=属性值2……)</li>
<li>注解可以作用在方法、类、属性上面</li>
<li>使用注解目的：简化xml配置</li>
</ul>
<p>2、spring针对bean管理中创建对象提供的注解</p>
<ul>
<li>@Component：普通注解</li>
<li>@Service：业务逻辑层，service层</li>
<li>@Controller：web层</li>
<li>@Repository：dao层</li>
</ul>
<p>上面四个注解功能是一样的，都可以用来创建bean实例</p>
<p>3、基于注解方式实现对象创建</p>
<p>（1）引入依赖 spring-aop</p>
<p>（2）开启组件扫描</p>
<p>引入context名称空间，开启组件扫描</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启组件扫描，若需要扫描多个包，写法：每个包之间用逗号隔开，写包的上层目录--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context</span> <span class="attr">component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.spring"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）创建类，在类上面添加创建对象注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在注解里面value值可以不写</span></span><br><span class="line"><span class="comment">//默认值是类名称首字母小写</span></span><br><span class="line"><span class="meta">@Component</span>(value=<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、开启组件扫描中的一些细节问题</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--示例1 use-default-filters="false",表示不使用默认filters，自己配置filters--&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--context:include-filter，设置扫描哪些内容--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.spring5"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Component"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--示例2 context:exclude-filter,设置哪些内容不进行扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.spring5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 5、基于注解方式实现属性注入</p>
<p>（1）@AutoWired：根据属性类型进行自动注入</p>
<p>第一步 创建service和dao对象，并且添加注解</p>
<p>第二步 service注入dao对象，在service类中添加dao类型属性，在属性上面进行注解</p>
<p>（2）@Qualifier：根据属性名称进行自动注入</p>
<p>需要和@AutoWired一起进行使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注解属性不需要加set方法</span></span><br><span class="line"><span class="comment">//添加注入属性注解</span></span><br><span class="line"><span class="meta">@Autowired</span>  <span class="comment">//根据类型进行注入</span></span><br><span class="line"><span class="meta">@Qualifier</span>(value = <span class="string">"userDao2"</span>) <span class="comment">//如果Dao接口有多个实现类，无法确定注入哪一个</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>

<p>（3）@resource：可以根据类型进行注入，也可以根据名称进行注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Resource  //根据类型注入</span></span><br><span class="line"><span class="comment">//Resource是javax即java扩展包中的注解，所以官方建议用AutoWired和Qualifier</span></span><br><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"userDao2"</span>)</span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>

<p>（4）Value：注入普通类型属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(value = <span class="string">"abcd"</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure>

<p> 6、完全注解开发</p>
<p>（1）创建配置类，替代xml配置文件</p>
<p>类上面加上@Configuration注解即可代表注解类，还要加ComponentScan(basePackage=“”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com.atguigu.spring5"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）编写测试类（和之前不一样）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载配置类</span></span><br><span class="line">ApplicationContext context=<span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">UserService us=context.getBean(<span class="string">"userService"</span>, UserService<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="AOP-Aspect-Oriented-Programming"><a href="#AOP-Aspect-Oriented-Programming" class="headerlink" title="AOP(Aspect Oriented Programming)"></a>AOP(Aspect Oriented Programming)</h2><h3 id="什么是AOP"><a href="#什么是AOP" class="headerlink" title="什么是AOP"></a>什么是AOP</h3><p>（1）面向切面（方面）编程，利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑的各个部分之间的耦合度降低，提高程序的可重用性，同时提高开发效率。</p>
<p>（2）通俗描述：不修改源代码，在主干功能里面添加新功能。</p>
<p><img src= "/img/loading.gif" data-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy91SkRBVUtyR0M3SkFlVFlPYWFINnJaNldtTExnd1FMSFZPWjFKcFJiN1ZpYXByWkNSWHNVYkgwYlpwaWJpYVRqcWliNjhMUUhPV1ppY1N2dVU4WTFkcXVVVkd3LzY0MA?x-oss-process=image/format,png" alt="img"> </p>
<h3 id="AOP底层原理"><a href="#AOP底层原理" class="headerlink" title="AOP底层原理"></a>AOP底层原理</h3><p>AOP底层使用动态代理，有两种动态代理情况：</p>
<p>有接口的情况，使用JDK动态代理，<strong>==创建接口实现类的代理对象==</strong>，实现代理。</p>
<p><img src= "/img/loading.gif" data-src="http://ww1.sinaimg.cn/large/ad3c4311gy1glte09od0kj20fe03w3z4.jpg" alt="img"> </p>
<p>没有接口的情况，使用CGLIB动态代理，<strong>==创建子类的代理对象==</strong>，增强方法。</p>
<p><img src= "/img/loading.gif" data-src="http://ww1.sinaimg.cn/large/ad3c4311gy1glte0vko4sj20d104mgm6.jpg" alt="img"> </p>
<h3 id="AOP动态代理"><a href="#AOP动态代理" class="headerlink" title="AOP动态代理"></a>AOP动态代理</h3><p>1、使用JDK动态代理，使用JDK里面的Proxy类里面的方法实现动态代理（java.lang.reflect包里面Proxy类）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader,类&lt;?&gt; interfaces,InvocationHandler h)</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>（1）newProxyInstance方法有三个参数:</p>
<ul>
<li>loader：类加载器</li>
<li>interfaces：增强方法所在的类实现的接口，支持多个各接口</li>
<li>InvocationHandler：实现InvocationHandler接口，创建代理对象，写增强方法</li>
</ul>
<p>2、JDK动态代理代码</p>
<p>（1）创建接口</p>
<p>（2）创建接口的实现类，实现方法</p>
<p>（3）使用Proxy类创建接口的代理对象</p>
<h3 id="AOP术语"><a href="#AOP术语" class="headerlink" title="AOP术语"></a>AOP术语</h3><p>连接点：类里面哪些方法可以被增强，这些方法称为连接点。</p>
<p>切入点：实际被真正增强的方法，称为切入点。</p>
<p>通知（增强）：实际增强的逻辑部分称为通知。通知有多种类型：前置通知、后置通知、环绕通知、异常通知、最终通知。</p>
<p>切面：指动作，把通知应用到切入点的过程。</p>
<h3 id="AOP操作（准备工作）"><a href="#AOP操作（准备工作）" class="headerlink" title="AOP操作（准备工作）"></a>AOP操作（准备工作）</h3><p>1、spring框架一般都是基于AspectJ实现AOP操作。AspectJ是独立的AOP框架，不是spring的组成部分，一般把AspectJ和Spring一起使用，进行AOP操作。基于AspectJ实现AOP操作有两种方式：</p>
<p>（1）基于xml文件方式</p>
<p>（2）基于注解方式（常用）</p>
<p>2、在项目中引入AOP相关依赖</p>
<p>3、切入点表达式</p>
<p>（1）作用：知道对哪个类中的哪个方法进行增强</p>
<p>（2）语法结构：</p>
<p>execution（[权限修饰符] （空格） [返回类型(可省略)][类全路径][方法名称]（[参数列表]））</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//举例1：对 com.atguigu.Dao.BookDao的add方法增强</span></span><br><span class="line">execution（* com.atguigu.Dao.BookDao.add(..))</span><br><span class="line"><span class="comment">//举例1：对 com.atguigu.Dao.BookDao的所有方法增强</span></span><br><span class="line">execution（* com.atguigu.Dao.BookDao.*(..))</span><br><span class="line"><span class="comment">//举例1：对 com.atguigu.Dao的所有类的所有方法增强</span></span><br><span class="line">execution（* com.atguigu.Dao.*.*(..))</span><br></pre></td></tr></table></figure>

<h3 id="基于AspectJ注解进行Aop操作"><a href="#基于AspectJ注解进行Aop操作" class="headerlink" title="基于AspectJ注解进行Aop操作"></a>基于AspectJ注解进行Aop操作</h3><p>准备：创建类，定义方法。创建增强类，写增强逻辑。</p>
<p>1、进行通知配置</p>
<p>（1）配置文件中开启注解扫描</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启注解扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.spring5.aopanno"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）使用注解创建User和UserProxy对象  @Component</p>
<p>（3）在增强类上面添加注解@Aspect</p>
<p>（4）在配置文件中开启生成代理对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启AspectJ生成代理对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、配置不同的通知类型</p>
<p>（1）在增强类，在作为通知方法的上面添加通知类型注解，使用切入点表达式配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//作为前置通知</span></span><br><span class="line"><span class="meta">@Before</span>(value = <span class="string">"execution(* com.atguigu.spring5.aopanno.User.add(..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">  System.out.println(<span class="string">"before......."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、公共切入点进行抽取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//公共切入点抽取</span></span><br><span class="line"><span class="meta">@Pointcut</span>(value = <span class="string">"execution(* com.atguigu.spring5.aopanno.User.add(..))"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、若有多个增强类对同一个方法进行增强，可以设置类的优先级。在增强类上面添加注解@Order（value=数值），数值越小越好。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order</span>(value = <span class="number">1</span>)</span><br><span class="line">......</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>5、完全使用注解开发</p>
<p>即创建配置类，不需要xml配置文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.atguigu.spring5.aopanno"</span>&#125;)</span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigAop</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//完全注解开发</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser2</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ApplicationContext context=<span class="keyword">new</span> AnnotationConfigApplicationContext(ConfigAop<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  User user=context.getBean(<span class="string">"user"</span>,User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  user.add();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="基于AspectJ-xml配置文件进行Aop操作"><a href="#基于AspectJ-xml配置文件进行Aop操作" class="headerlink" title="基于AspectJ xml配置文件进行Aop操作"></a>基于AspectJ xml配置文件进行Aop操作</h3><p>1、创建两个类，增强类和被增强类，创建方法</p>
<p>2、在spring配置文件中创建两个类对象</p>
<p>3、在配置文件中配置切入点</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.spring5.aopxml.Book"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookProxy"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.spring5.aopxml.BuyProxy"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置AOP增强--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置切入点--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"p"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.atguigu.spring5.aopxml.Book.buy(..))"</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--配置切面--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"bookProxy"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--增强作用在具体的方法上--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"p"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="JDBCTemplate"><a href="#JDBCTemplate" class="headerlink" title="JDBCTemplate"></a>JDBCTemplate</h2><p>1、什么是JdbcTemplate</p>
<p>Spring框架对Jdbc进行封装，使用jdbcTemplate对数据库进行操作更方便</p>
<p>2、准备工作</p>
<p>（1）引入相关jar包</p>
<p>（2）在配置文件中配置数据库连接池</p>
<p>（3）配置JdbcTemplate对象，将DataSource注入其中</p>
<p>（4）创建service类，创建dao类，在dao注入jdbctemplate对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--组件扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.atguigu.spring5"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入Dao</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">  	<span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title">BookDao</span></span>&#123;</span><br><span class="line">    <span class="comment">//注入jdbctemplate</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">  	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JDBCTemplate操作数据库"><a href="#JDBCTemplate操作数据库" class="headerlink" title="JDBCTemplate操作数据库"></a>JDBCTemplate操作数据库</h3><p>1、创建对应数据库的实体类</p>
<p>2、编写service和dao</p>
<p>（1）在dao中进行数据库添加操作</p>
<p>（2）调用JdbcTemplate对象里面的update方法实现添加操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> update=jdbcTemplate.update(sql,args);</span><br></pre></td></tr></table></figure>

<p>Update方法有两个参数：第一个sql语句；第二个可变参数，设置sql语句值。</p>
<p>3、修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//1 sql语句</span></span><br><span class="line">	String sql=<span class="string">"update book set bookname=?,booktype=? where bookid=?"</span>;</span><br><span class="line">	<span class="comment">//2 调用方法实现</span></span><br><span class="line">	Object[] args=&#123;book.getBookname(),book.getBooktype(),book.getBookid()&#125;;</span><br><span class="line">  	<span class="keyword">int</span> update=jdbcTemplate.update(sql,args);</span><br><span class="line">  	System.out.println(update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//1 sql语句</span></span><br><span class="line">	String sql=<span class="string">"delete from book where bookid=?"</span>;</span><br><span class="line">  	<span class="keyword">int</span> update=jdbcTemplate.update(sql,id);</span><br><span class="line">  	System.out.println(update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、查询返回某个值</p>
<p>1、查询表里面有多少条记录，返回某个值</p>
<p>2、利用JdbcTemplate的queryForObject方法实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryForObject(String sql,Class&lt;T&gt; requiredType)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>第二个参数代表返回类型class</p>
<p>6、查询返回对象</p>
<p>1、查询返回图书详情</p>
<p>2、JdbcTemplate查询返回对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">queryForObject(String sql,RowMapper&lt;T&gt; rowMapper,Object...args)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>rowMapper：接口，返回不同类型的数据，使用这个接口里面的实现类完成数据封装</p>
<p>args：参数值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Book book=jdbcTemplate.queryForObject(sql,<span class="keyword">new</span> BeanPropertyRowMapper&lt;Book&gt;(Book<span class="class">.<span class="keyword">class</span>),<span class="title">id</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>7、查询返回集合</p>
<p>（1）查询列表分页</p>
<p>（2）JdbcTemplate实现查询返回集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String sql=<span class="string">"select * from book"</span>;</span><br><span class="line">List&lt;Book&gt; booklist=jdbcTemplate.query(sql,<span class="keyword">new</span> BeanPropertyRowMapper&lt;Book&gt;(Book<span class="class">.<span class="keyword">class</span>))</span>;</span><br></pre></td></tr></table></figure>

<p>8、批量操作</p>
<p>JdbcTemplate批量操作指操作表里面的多条数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">batchUpdate(String sql,List&lt;Object[]&gt; batchArgs)&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>batchargs：添加的多条记录的数据，参数顺序要和sql语句问号对应。</p>
<p>（1）JdbcTemplate批量添加操作</p>
<p>insert into book values(?,?,?)</p>
<p>（2）JdbcTemplate批量修改操作 </p>
<p>update book set bookname=?,booktype=? where bookid=?</p>
<p>（3）JdbcTemplate删除操作 </p>
<p>delete from book where bookid=?</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>1、什么是事务</p>
<p>（1）事务是数据库操作的最基本单元。逻辑上的一组操作，要么成功，如果一个失败则所有操作都失败。</p>
<p>（2）典型场景：银行转账</p>
<p>（3）事务有四个特性（ACID）：原子性、一致性、隔离性、持久性。</p>
<h3 id="搭建事务操作环境"><a href="#搭建事务操作环境" class="headerlink" title="搭建事务操作环境"></a>搭建事务操作环境</h3><p>1、创建数据库，添加记录。</p>
<p>2、创建service类，创建dao类，完成对象创建和注入关系。</p>
<p>（1）Service注入dao，dao注入jdbctemplate，jdbctemplate注入datasource。</p>
<p>（2）在dao创建增加和减少的方法，在service创建转账的方法。</p>
<p>3、引入异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">  userDao.addMoney();</span><br><span class="line">  <span class="keyword">int</span> i=<span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">  userDao.reduceMoney();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（1）使用事务解决以上问题，编程式事务管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">userDao.addMoney();</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">  	userDao.reduceMoney();</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">	<span class="comment">//存在异常，事务回滚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="spring事务管理"><a href="#spring事务管理" class="headerlink" title="spring事务管理"></a>spring事务管理</h3><p>1、事务一般添加到javaEE三层结构的service层（业务逻辑层）上</p>
<p>2、两种事务管理方式：==编程式事务管理和声明式事务管理==</p>
<p>3、声明式事务管理：基于注解和基于xml文件方式</p>
<p>4、在spring中进行声明式事务管理，底层使用AOP原理</p>
<p>5、Spring事务管理api</p>
<p>spring提供一个接口，代表事务管理器，这个接口针对不同框架提供了不同实现类。</p>
<h3 id="基于注解的声明式事务管理"><a href="#基于注解的声明式事务管理" class="headerlink" title="基于注解的声明式事务管理"></a>基于注解的声明式事务管理</h3><p>1、在spring配置文件中配置事务管理器</p>
<p>2、在spring配置文件中开启事务注解</p>
<p>（1）在spring配置文件中引入名称空间tx</p>
<p>（2）开启事务注解</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）在service（或者service类的方法）上面开启事务注解，@Transactional</p>
<p>添加到类上面就代表这个类的所有方法都添加事务管理。</p>
<h3 id="声明式事务管理参数配置"><a href="#声明式事务管理参数配置" class="headerlink" title="声明式事务管理参数配置"></a>声明式事务管理参数配置</h3><p>1、在service类上面添加@transactional，可以配置一些事务相关参数</p>
<p>（1）propagation：事务传播行为</p>
<p>多事务方法直接进行调用，这个过程中事务是如何进行管理的。</p>
<p>事务的传播行为可以有传播属性指定，Spring定义了7种传播行为。</p>
<p><img src= "/img/loading.gif" data-src="http://ww1.sinaimg.cn/large/ad3c4311gy1glu9ijq6w2j20j00bdgms.jpg" alt="img">  </p>
<p>默认情况下使用REQUIRED</p>
<p>（2）Isolation：事务隔离级别</p>
<p>事务的隔离性，是指多事务之间不会互相影响，不考虑隔离性会产生很多问题。</p>
<p>有三个读问题：脏读、不可重复读、虚（幻）读 </p>
<ul>
<li>脏读：一个未提交事务读取到另一个未提交事务的数据。</li>
<li>不可重复读：一个未提交事务读取到另一个提交事务的修改的数据。</li>
<li>虚读：一个未提交事务读取到另一个提交事务的添加的数据。</li>
</ul>
<p>通过设置事务隔离级别，就解决事务隔离性的问题。</p>
<table>
<thead>
<tr>
<th align="left">事务隔离级别</th>
<th align="left"><strong>脏读</strong></th>
<th align="left">不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td align="left">READ_UNCOMMITTED</td>
<td align="left">允许</td>
<td align="left">允许</td>
<td>允许</td>
</tr>
<tr>
<td align="left">READ_COMMITTED</td>
<td align="left">禁止</td>
<td align="left">允许</td>
<td>允许</td>
</tr>
<tr>
<td align="left">REPEATABLE_READ</td>
<td align="left">禁止</td>
<td align="left">禁止</td>
<td>允许</td>
</tr>
<tr>
<td align="left">SERIALIZABLE</td>
<td align="left">禁止</td>
<td align="left">禁止</td>
<td>禁止</td>
</tr>
</tbody></table>
<p>mysql默认设置的是可重复读（REPEATABLE_READ）。</p>
<p>（3）readOnly：是否只读</p>
<ul>
<li>事务需要在一定时间内进行提交，如果不进行提交则进行回滚。</li>
<li>默认值是-1,设置时间以秒为单位进行计算。</li>
</ul>
<p>（4）Timeout：超时时间</p>
<p>（5）rollBackFor：回滚</p>
<p>设置出现哪些异常进行回滚</p>
<p>（6）norollBackFor：不回滚</p>
<p>设置出现哪些异常进行不进行回滚</p>
<h3 id="基于xml方式的声明式事务管理"><a href="#基于xml方式的声明式事务管理" class="headerlink" title="基于xml方式的声明式事务管理"></a>基于xml方式的声明式事务管理</h3><p>基于xml方式的声明式事务管理，指在spring配置文件中进行配置。</p>
<ol>
<li>配置事务管理器</li>
<li>配置通知（Aop中增强的那部分就叫通知）</li>
<li>配置切入点和切面</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置通知--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txadvice"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--指定在哪种规则的方法上面添加事务--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"updateAccount"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置切入点和切面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切入点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pt"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.atguigu.spring5.service.UserService.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txadvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pt"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="完全注解声明式事务管理"><a href="#完全注解声明式事务管理" class="headerlink" title="完全注解声明式事务管理"></a>完全注解声明式事务管理</h3><p>创建配置类，使用配置类替代xml配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context=<span class="keyword">new</span> AnnotationConfigApplicationContext(TxConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">UserService userService=context.getBean(<span class="string">"userService"</span>,UserService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">userService.updateAccount();</span><br></pre></td></tr></table></figure>

<h3 id="Spring5框架新功能"><a href="#Spring5框架新功能" class="headerlink" title="Spring5框架新功能"></a>Spring5框架新功能</h3><p>1、整个框架的代码基于java8，运行时兼容jdk9，许多不建议使用的类和方法在代码库中删除。</p>
<p>2、Spring 5.0框架自带了通用的日志封装</p>
<p>（1）spring5已经移除了log4jConfigListenr，官方建议使用log4j2。</p>
<p>（2）Spring5整合了log4j2</p>
<p>使用：</p>
<p>第一步 引入jar包</p>
<p>第二步 创建log4j2.xml配置文件</p>
<p>3、spring5框架核心容器支持@Nullable注解</p>
<p>@Nullable注解可以使用在方法、属性、参数上面，表示方法返回值、属性值、参数值可以为空。 </p>
<p>4、spring5框架核心容器支持==函数式风格==</p>
<p>GenericApplicationContext，AnnotationConfigApplicationContext</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数式风格创建对象，交给Spring进行管理</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGenericApplicatonContext</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//1 创建GenericApplication对象</span></span><br><span class="line">	GenericApplicationContext context=<span class="keyword">new</span> GenericApplicationContext();</span><br><span class="line">	context.refresh();</span><br><span class="line">    <span class="comment">//2 调用registerBean方法进行注册</span></span><br><span class="line">	context.registerBean(<span class="string">"user1"</span>,User<span class="class">.<span class="keyword">class</span>,() -&gt; <span class="title">new</span> <span class="title">User</span>())</span>;</span><br><span class="line">    <span class="comment">//3 获取在Spring注册的对象</span></span><br><span class="line">    User user=(User) context.getBean(<span class="string">"user1"</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、spring支持整合JUnit 5</p>
<p>（1）整合JUnit4</p>
<p>第一步 引入spring相关针对测试依赖：spring-test，hamcrest-core，junit-4.12</p>
<p>第二步 创建测试类，使用注解方式完成</p>
<p>（2）spring5整合Junit5</p>
<p>第一步 引入junit5相关jar包</p>
<p>第二步 创建测试类，使用Junit5注解完成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="comment">//@ContextConfiguration(locations="classpath:bean1.xml");</span></span><br><span class="line"><span class="meta">@SpringJUnitConfig</span>(locations=<span class="string">"classpath:bean1.xml"</span>)  <span class="comment">//复合注解，替代上面两个</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JTest5</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	userService.updateAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="spring5—–新功能Springwebflux"><a href="#spring5—–新功能Springwebflux" class="headerlink" title="spring5—–新功能Springwebflux"></a>spring5—–新功能Springwebflux</h3><p><img src= "/img/loading.gif" data-src="http://ww1.sinaimg.cn/large/ad3c4311gy1glrz6pdhyoj20kd0f0gnv.jpg" alt="spring framework runtime"> </p>
<ol>
<li>springwebflux介绍</li>
<li>响应式编程</li>
<li>Webflux执行流程和核心api</li>
<li>SpringWebFlux（基于注解编程模型）</li>
<li>SpringWebFlux（基于函数式编程模型）</li>
</ol>
<p>webflux涉及以下其他知识：springMVC，springBoot，Maven，Java8新特性。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">dabing693</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/09/07/Spring5%E6%95%99%E7%A8%8B/">http://yoursite.com/2021/09/07/Spring5%E6%95%99%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">小辉博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/09/07/SpringMVC/"><img class="prev-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringMVC</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/07/Mybatis%20IDEA%E7%89%88%E6%95%99%E7%A8%8B/"><img class="next-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mybatis IDEA版教程</div></div></a></div></nav></article></main><footer id="footer" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By dabing693</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/js/hideMobileSidebar.js"></script></body></html>